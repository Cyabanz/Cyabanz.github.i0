<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shop</title>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDQcJNa_j_PC3-K5er4ms0WvVXQS_CEcuE",
            authDomain: "algebras4-44f23.firebaseapp.com",
            databaseURL: "https://algebras4-44f23-default-rtdb.firebaseio.com",
            projectId: "algebras4-44f23",
            storageBucket: "algebras4-44f23.appspot.com",
            messagingSenderId: "512062724744",
            appId: "1:512062724744:web:653e3c7a504fb7255fdd3d",
            measurementId: "G-4R378XMPSW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);
        const auth = getAuth(app);

        // Function to initialize user data (if not done in progress.html)
        function initializeUserData(userId) {
            const userRef = ref(database, 'users/' + userId);
            const initialData = {
                coins: 3000,
                lastRewardClaim: null, // Set this to null initially
                dailyProgress: {
                    day1: false,
                    day2: false,
                    day3: false,
                    day4: false,
                    day5: false,
                    day6: false,
                    day7: false
                },
                purchasedItems: {
                    item1: false,
                    item2: false
                }
            };

            set(userRef, initialData)
                .then(() => {
                    console.log('User data initialized successfully!');
                })
                .catch((error) => {
                    console.error('Error initializing user data: ', error);
                });
        }

        // Function to handle purchasing an item
        function purchaseItem(userId, itemId, itemPrice) {
            const userRef = ref(database, 'users/' + userId);
            onValue(userRef, (snapshot) => {
                const userData = snapshot.val();
                if (userData.coins >= itemPrice) {
                    const updatedCoins = userData.coins - itemPrice;
                    const updatedPurchasedItems = { ...userData.purchasedItems, [itemId]: true };
                    set(userRef, { ...userData, coins: updatedCoins, purchasedItems: updatedPurchasedItems });
                    console.log(`Purchased ${itemId} successfully!`);
                } else {
                    console.log('Not enough coins to purchase this item.');
                }
            });
        }

        // Call this function after the user signs up or logs in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                const userId = user.uid; // Get the signed-in user's ID
                initializeUserData(userId);

                // Example of purchasing an item (you might replace this with actual button clicks)
                // purchaseItem(userId, 'item1', 1000); // Uncomment this to test purchasing
            }
        });
    </script>
</head>
<body>
    <h1>Shop</h1>
    <!-- Display shop items here -->
    <div>
        <h2>Available Items</h2>
        <div id="shop-items">
            <!-- Your shop items will be displayed here -->
        </div>
    </div>
</body>
</html>
