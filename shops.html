<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.0/firebase-database.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .item {
            margin: 10px 0;
        }
        .item button {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <h1>Shop</h1>
    <div id="coin-balance"></div>
    <div class="item">
        <span>Hacks (Cost: 50 coins)</span>
        <button onclick="purchaseItem('hacks', 50)">Buy</button>
    </div>
    <div class="item">
        <span>Test (Cost: 50 coins)</span>
        <button onclick="purchaseItem('test', 50)">Buy</button>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDQcJNa_j_PC3-K5er4ms0WvVXQS_CEcuE",
            authDomain: "algebras4-44f23.firebaseapp.com",
            databaseURL: "https://algebras4-44f23-default-rtdb.firebaseio.com",
            projectId: "algebras4-44f23",
            storageBucket: "algebras4-44f23.appspot.com",
            messagingSenderId: "512062724744",
            appId: "1:512062724744:web:653e3c7a504fb7255fdd3d",
            measurementId: "G-4R378XMPSW"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        const auth = firebase.auth();
        const db = firebase.database();

        // Fetch user's coin balance on page load
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                const userId = user.uid;
                const userRef = db.ref(`users/${userId}`);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();

                if (userData) {
                    document.getElementById('coin-balance').innerText = `Your coin balance: ${userData.coins}`;
                } else {
                    document.getElementById('coin-balance').innerText = "User data not found.";
                }
            } else {
                document.getElementById('coin-balance').innerText = "Please sign in to view your shop.";
            }
        });

        // Purchase item function
        async function purchaseItem(itemName, cost) {
            const user = auth.currentUser;

            if (user) {
                const userId = user.uid;
                const userRef = db.ref(`users/${userId}`);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();

                if (userData && userData.coins >= cost) {
                    userData.coins -= cost; // Deduct coins for purchase
                    await userRef.update(userData); // Update user data in the database
                    alert(`You have purchased ${itemName}!`);
                    document.getElementById('coin-balance').innerText = `Your new coin balance: ${userData.coins}`;
                } else if (userData) {
                    alert("You do not have enough coins to purchase this item.");
                }
            } else {
                alert("You need to be signed in to purchase items.");
            }
        }
    </script>
</body>
</html>
