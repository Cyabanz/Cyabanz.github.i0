<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Ratings</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="games-container"></div>

    <!-- Firebase Setup -->
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js"></script>
    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDQcJNa_j_PC3-K5er4ms0WvVXQS_CEcuE",
            authDomain: "algebras4-44f23.firebaseapp.com",
            databaseURL: "https://algebras4-44f23-default-rtdb.firebaseio.com",
            projectId: "algebras4-44f23",
            storageBucket: "algebras4-44f23.appspot.com",
            messagingSenderId: "512062724744",
            appId: "1:512062724744:web:653e3c7a504fb7255fdd3d",
            measurementId: "G-4R378XMPSW"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Fetch the JSON data from weed.json
        fetch('weed.json')
            .then(response => response.json())
            .then(gamesData => {
                displayGames(gamesData);
            })
            .catch(error => console.error('Error fetching JSON:', error));

        function displayGames(gamesData) {
            const container = document.getElementById('games-container');
            gamesData.forEach((game, index) => {
                const gameDiv = document.createElement('div');
                gameDiv.className = 'game-card';
                gameDiv.innerHTML = `
                    <img src="${game.banner}" alt="${game.title} Banner">
                    <h2>${game.title}</h2>
                    <p>${game.description}</p>
                    <a href="${game.link}" target="_blank">Play Now</a>
                    <div>
                        <label for="rating-${index}">Rate this game:</label>
                        <input type="number" id="rating-${index}" min="1" max="5" placeholder="1-5">
                        <button onclick="submitRating('${game.title}', ${index})">Submit</button>
                        <p id="average-rating-${index}">Average Rating: Loading...</p>
                    </div>
                `;
                container.appendChild(gameDiv);
                fetchAverageRating(game.title, index);
            });
        }

        function submitRating(gameTitle, index) {
            const ratingInput = document.getElementById(`rating-${index}`);
            const rating = parseInt(ratingInput.value);
            if (rating < 1 || rating > 5 || isNaN(rating)) {
                alert('Please enter a rating between 1 and 5.');
                return;
            }

            // Store the rating in Firebase
            const ratingsRef = database.ref('ratings/' + gameTitle);
            ratingsRef.push(rating)
                .then(() => {
                    ratingInput.value = ''; // Clear the input
                    fetchAverageRating(gameTitle, index); // Refresh the average rating
                })
                .catch(error => console.error('Error saving rating:', error));
        }

        function fetchAverageRating(gameTitle, index) {
            const ratingsRef = database.ref('ratings/' + gameTitle);
            ratingsRef.once('value').then(snapshot => {
                const ratings = snapshot.val();
                if (ratings) {
                    const ratingValues = Object.values(ratings);
                    const average = ratingValues.reduce((a, b) => a + b, 0) / ratingValues.length;
                    document.getElementById(`average-rating-${index}`).innerText = `Average Rating: ${average.toFixed(2)}`;
                } else {
                    document.getElementById(`average-rating-${index}`).innerText = 'Average Rating: Not Rated Yet';
                }
            });
        }
    </script>
</body>
</html>
