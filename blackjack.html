<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Game</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
        import { getDatabase, ref, set, get, child, update } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDQcJNa_j_PC3-K5er4ms0WvVXQS_CEcuE",
            authDomain: "algebras4-44f23.firebaseapp.com",
            databaseURL: "https://algebras4-44f23-default-rtdb.firebaseio.com",
            projectId: "algebras4-44f23",
            storageBucket: "algebras4-44f23",
            messagingSenderId: "512062724744",
            appId: "1:512062724744:web:653e3c7a504fb7255fdd3d",
            measurementId: "G-4R378XMPSW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let currentUserId = null;

        // Check user authentication state
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUserId = user.uid;
                document.getElementById("loginButton").style.display = "none"; // Hide login button
                document.getElementById("loggedInMessage").innerText = "Welcome, " + user.displayName;
                document.getElementById("gameArea").style.display = "block"; // Show game area
            } else {
                currentUserId = null;
                document.getElementById("loginButton").style.display = "block"; // Show login button
                document.getElementById("gameArea").style.display = "none"; // Hide game area
                alert("Please login to play!");
            }
        });

        // Function to sign in with Google
        window.signIn = function() {
            signInWithPopup(auth, provider).then((result) => {
                console.log("User signed in:", result.user);
                const userRef = ref(db, 'users/' + result.user.uid);

                // Check if user data already exists
                get(userRef).then((snapshot) => {
                    if (!snapshot.exists()) {
                        // Initialize user data only if it doesn't exist
                        set(userRef, {
                            coins: 0,
                            lastClaimDate: null // No claims yet
                        });
                    }
                }).catch((error) => {
                    console.error("Error checking user data:", error);
                });
            }).catch((error) => {
                console.error("Error signing in:", error);
            });
        };

        // Blackjack game variables
        let playerCoins = 1000; // Starting coins
        let betAmount = 0;

        // Start a new game
        function startGame() {
            if (currentUserId) {
                document.getElementById("betAmountDisplay").innerText = betAmount;
                document.getElementById("gameMessage").innerText = "Place your bet and start the game!";
                document.getElementById("betAmount").value = 0;
                document.getElementById("gameControls").style.display = "block"; // Show game controls
            } else {
                alert("Please login to play!");
            }
        }

        // Function to update bet amount
        function updateBetAmount() {
            betAmount = parseInt(document.getElementById("betAmount").value, 10);
            if (betAmount > playerCoins) {
                alert("You don't have enough coins to place this bet.");
                betAmount = playerCoins; // Reset to max coins
            }
            document.getElementById("betAmountDisplay").innerText = betAmount;
        }

        // Function to handle Hit or Stand
        function hitOrStand(action) {
            if (action === "hit") {
                // Add game logic for hitting
                document.getElementById("gameMessage").innerText = "You chose to hit! [Game Logic Here]";
            } else {
                // Add game logic for standing
                document.getElementById("gameMessage").innerText = "You chose to stand! [Game Logic Here]";
            }
        }
    </script>
</head>
<body>
    <h1>Blackjack Game</h1>
    <button id="loginButton" onclick="signIn()">Login with Google</button>
    <h2 id="loggedInMessage"></h2>

    <div id="gameArea" style="display:none;">
        <h3>Your Coins: <span id="coinCount">1000</span></h3>
        <button onclick="startGame()">Start Game</button>
        
        <div id="gameControls" style="display:none;">
            <h3>Place your bet (1-1000):</h3>
            <input type="range" id="betAmount" min="1" max="1000" value="0" oninput="updateBetAmount()">
            <p>Bet Amount: <span id="betAmountDisplay">0</span></p>
            <button onclick="hitOrStand('hit')">Hit</button>
            <button onclick="hitOrStand('stand')">Stand</button>
        </div>
        
        <h2 id="gameMessage"></h2>
    </div>
</body>
</html>
