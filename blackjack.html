<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        #gameContainer {
            display: none; /* Hidden until the game starts */
            text-align: center;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        #betSlider {
            margin: 20px 0;
            width: 300px;
        }
    </style>
</head>
<body>
    <h1>Blackjack Game</h1>
    <button id="loginButton" onclick="signIn()">Login with Google</button>
    <h2 id="loggedInMessage"></h2>
    <div id="betContainer">
        <label for="betSlider">Select Bet Amount (1-1000): </label>
        <input type="range" id="betSlider" min="1" max="1000" value="1">
        <span id="betAmount">1</span>
    </div>
    <button id="startGameButton" onclick="startGame()">Start Game</button>
    <div id="gameContainer">
        <h2 id="gameStatus"></h2>
        <button id="hitButton" onclick="hit()">Hit</button>
        <button id="standButton" onclick="stand()">Stand</button>
    </div>

    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
        import { getDatabase, ref, set, get, child, update } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDQcJNa_j_PC3-K5er4ms0WvVXQS_CEcuE",
            authDomain: "algebras4-44f23.firebaseapp.com",
            databaseURL: "https://algebras4-44f23-default-rtdb.firebaseio.com",
            projectId: "algebras4-44f23",
            storageBucket: "algebras4-44f23",
            messagingSenderId: "512062724744",
            appId: "1:512062724744:web:653e3c7a504fb7255fdd3d",
            measurementId: "G-4R378XMPSW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let currentUserId = null;

        // Check user authentication state
        onAuthStateChanged(auth, (user) => {
            const loginButton = document.getElementById("loginButton");
            const loggedInMessage = document.getElementById("loggedInMessage");
            if (user) {
                currentUserId = user.uid;
                loginButton.style.display = "none"; // Hide login button
                loggedInMessage.innerText = "You are logged in as " + user.displayName;
                document.getElementById("betContainer").style.display = "block"; // Show betting options
            } else {
                loggedInMessage.innerText = ""; // Clear logged-in message
                document.getElementById("betContainer").style.display = "none"; // Hide betting options
            }
        });

        // Function to start the game
        window.startGame = function() {
            if (!currentUserId) {
                alert("Please log in to play!");
                return;
            }
            document.getElementById("gameContainer").style.display = "block"; // Show game container
            document.getElementById("gameStatus").innerText = "Game in progress...";
            // Initialize game logic here...
        };

        // Function to handle "Hit" action
        window.hit = function() {
            // Game logic for hitting
            alert("You chose to hit!");
        };

        // Function to handle "Stand" action
        window.stand = function() {
            // Game logic for standing
            alert("You chose to stand!");
        };

        // Function to sign in with Google
        window.signIn = function() {
            signInWithPopup(auth, provider).then((result) => {
                console.log("User signed in:", result.user);
                const userRef = ref(db, 'users/' + result.user.uid);
                get(userRef).then((snapshot) => {
                    if (!snapshot.exists()) {
                        set(userRef, {
                            coins: 0,
                            lastClaimDate: null // No claims yet
                        });
                    }
                }).catch((error) => {
                    console.error("Error checking user data:", error);
                });
            }).catch((error) => {
                console.error("Error signing in:", error);
            });
        };

        // Update bet amount display
        document.getElementById("betSlider").addEventListener("input", function() {
            document.getElementById("betAmount").innerText = this.value;
        });
    </script>
</body>
</html>
