<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blackjack Gambling System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    .card {
      width: 60px;
      height: 90px;
      border-radius: 8px;
      background-color: white;
      border: 2px solid #000;
      display: inline-block;
      line-height: 90px;
      font-size: 20px;
      text-align: center;
      margin: 10px;
      transition: transform 0.5s ease;
    }
    .cards-container {
      margin: 20px;
    }
    .coin-balance {
      margin-bottom: 20px;
    }
    .bet-container {
      margin: 20px;
    }
    .game-buttons {
      margin-top: 20px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Blackjack Gambling System</h1>

  <button id="login-btn">Login with Google</button>
  <button id="logout-btn" class="hidden">Logout</button>

  <div class="coin-balance hidden">
    <strong>Current Coins:</strong> <span id="coins">Loading...</span>
  </div>

  <div class="bet-container hidden">
    <label for="bet">Place your bet (5 - 10 coins): </label>
    <input type="range" id="bet" min="5" max="10" value="5" oninput="updateBetLabel()">
    <span id="betLabel">5</span> coins
    <button onclick="startGame()">Start Game</button>
  </div>

  <div class="cards-container hidden">
    <h3>Your Cards:</h3>
    <div id="playerCards"></div>
    <h3>Dealer's Cards:</h3>
    <div id="dealerCards"></div>
  </div>

  <div class="game-buttons hidden">
    <button onclick="hit()">Hit</button>
    <button onclick="stand()">Stand</button>
  </div>

  <div class="result hidden" id="result"></div>

  <!-- Firebase Setup -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDQcJNa_j_PC3-K5er4ms0WvVXQS_CEcuE",
      authDomain: "algebras4-44f23.firebaseapp.com",
      databaseURL: "https://algebras4-44f23-default-rtdb.firebaseio.com",
      projectId: "algebras4-44f23",
      storageBucket: "algebras4-44f23.appspot.com",
      messagingSenderId: "512062724744",
      appId: "1:512062724744:web:653e3c7a504fb7255fdd3d",
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    let userId;
    let userCoins = 1000; // Default coins
    let deck = [];
    let playerHand = [];
    let dealerHand = [];

    // Firebase Authentication with Google
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');

    loginBtn.addEventListener('click', () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then((result) => {
        userId = result.user.uid;
        handleUserLogin();
      }).catch((error) => {
        console.error('Login failed:', error);
      });
    });

    logoutBtn.addEventListener('click', () => {
      auth.signOut().then(() => {
        logoutBtn.classList.add('hidden');
        loginBtn.classList.remove('hidden');
        document.querySelector('.coin-balance').classList.add('hidden');
        document.querySelector('.bet-container').classList.add('hidden');
      });
    });

    function handleUserLogin() {
      loginBtn.classList.add('hidden');
      logoutBtn.classList.remove('hidden');
      document.querySelector('.coin-balance').classList.remove('hidden');
      document.querySelector('.bet-container').classList.remove('hidden');
      checkAndSetInitialCoins();
    }

    // Check if the user has coins, if not, set to 1000
    function checkAndSetInitialCoins() {
      const userRef = db.ref('users/' + userId);
      userRef.once('value').then(snapshot => {
        if (!snapshot.exists()) {
          userRef.set({ coins: 1000 });
          userCoins = 1000;
        } else {
          userCoins = snapshot.val().coins;
        }
        document.getElementById('coins').innerText = userCoins;
      });
    }

    // Update bet label based on scroll input
    function updateBetLabel() {
      const betValue = document.getElementById('bet').value;
      document.getElementById('betLabel').innerText = betValue;
    }

    // Start the game
    function startGame() {
      const betAmount = parseInt(document.getElementById('bet').value);
      if (userCoins >= betAmount) {
        document.querySelector('.cards-container').classList.remove('hidden');
        document.querySelector('.game-buttons').classList.remove('hidden');
        document.getElementById('result').classList.add('hidden');
        playerHand = [];
        dealerHand = [];
        deck = createDeck();
        dealInitialCards();
      } else {
        alert('Not enough coins to place the bet!');
      }
    }

    // Create a deck of cards
    function createDeck() {
      const suits = ['♠', '♥', '♦', '♣'];
      const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
      let deck = [];
      for (let suit of suits) {
        for (let value of values) {
          deck.push({ value, suit });
        }
      }
      return shuffle(deck);
    }

    // Shuffle the deck
    function shuffle(deck) {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }

    // Deal initial cards to player and dealer
    function dealInitialCards() {
      playerHand.push(deck.pop());
      playerHand.push(deck.pop());
      dealerHand.push(deck.pop());
      dealerHand.push(deck.pop());
      renderCards();
    }

    // Render cards with animation
    function renderCards() {
      const playerCardsDiv = document.getElementById('playerCards');
      const dealerCardsDiv = document.getElementById('dealerCards');
      playerCardsDiv.innerHTML = '';
      dealerCardsDiv.innerHTML = '';

      playerHand.forEach((card, index) => {
        setTimeout(() => {
          const cardDiv = document.createElement('div');
          cardDiv.classList.add('card');
          cardDiv.innerText = card.value + card.suit;
          playerCardsDiv.appendChild(cardDiv);
        }, index * 500);
      });

      dealerHand.forEach((card, index) => {
        setTimeout(() => {
          const cardDiv = document.createElement('div');
          cardDiv.classList.add('card');
          cardDiv.innerText = card.value + card.suit;
          dealerCardsDiv.appendChild(cardDiv);
        }, index * 500);
      });
    }

    // Handle "Hit" action
    function hit() {
      playerHand.push(deck.pop());
      renderCards();
      if (calculateHandValue(playerHand) > 21) {
        endGame('lose');
      }
    }

    // Handle "Stand" action
    function stand() {
      while (calculateHandValue(dealerHand) < 17) {
        dealerHand.push(deck.pop());
        renderCards();
      }
      checkWinner();
    }

    // Calculate hand value
    function calculateHandValue(hand) {
      let total = 0;
      let aces = 0;
      hand.forEach(card => {
        if (['J', 'Q', 'K'].includes(card.value)) {
          total += 10;
        } else if (card.value === 'A') {
          aces += 1;
          total += 11;
        } else {
          total += parseInt(card.value);
        }
      });
      while (total > 21 && aces > 0) {
        total -= 10;
        aces -= 1;
      }
      return total;
    }

    // Check who wins
    function checkWinner() {
      const playerValue = calculateHandValue(playerHand);
      const dealerValue = calculateHandValue(dealerHand);
      if (dealerValue > 21 || playerValue > dealerValue) {
        endGame('win');
      } else if (playerValue < dealerValue) {
        endGame('lose');
      } else {
        endGame('draw');
      }
    }

    // End the game and show result
    function endGame(result) {
      let betAmount = parseInt(document.getElementById('bet').value);
      if (result === 'win') {
        userCoins += betAmount;
        document.getElementById('result').innerText = "You Win!";
      } else if (result === 'lose') {
        userCoins -= betAmount;
        document.getElementById('result').innerText = "You Lose!";
      } else {
        document.getElementById('result').innerText = "It's a Draw!";
      }
      db.ref('users/' + userId + '/coins').set(userCoins);
      document.getElementById('coins').innerText = userCoins;
      document.getElementById('result').classList.remove('hidden');
      document.querySelector('.cards-container').classList.add('hidden');
      document.querySelector('.game-buttons').classList.add('hidden');
    }
  </script>
</body>
</html>
