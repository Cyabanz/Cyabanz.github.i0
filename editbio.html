<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui, shrink-to-fit=yes">
      <title>Study.com | Bio</title>
      <link href="/styles.css" rel="stylesheet" type="text/css" />
      <link href="/sys/alert.css" rel="stylesheet" type="text/css" />
      <link rel="manifest" href="manifest.json"/>
      <link rel="icon" href="/images/logo.gif">
      <meta property="og:title" content="frogie's arcade">
      <meta name="theme-color" content="#00ffa6">
      <meta name="msapplication-TileColor" content="#00ffa6">
      <meta property="og:image" content="/images/logo.gif">
      <meta name="description" content="profiles go hard">
      <meta property="og:description" content="profiles go hard">
      
    <style>
    body{
        text-align: center;
    }
    header {
        text-align: center;
    }
    .rainbowtitle {
        display: inline-block;
    }
        h1{
            color: #fff;
        }
    </style>
</head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-43Q4DLBWP2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-43Q4DLBWP2');
    </script>
<body>
  <noscript>enable javascript you dumb monkey</noscript>
    <script src="/sys/alert.js"></script>
    <div class="message-box" id="messageBox"></div>
    <header>
        <img class="logo" src="/images/logo.gif" width=55px height=55px onclick="window.location.href='/';">
        <div class="navbar-right">
            <button id="headerbtn" onclick="window.location.href='/math/index.html';">Unblocked</button></a>
            <button id="headerbtn" onclick="window.location.href='/reading/';">Apps</button>
            <button id="headerbtn" onclick="window.location.href='/partners.html';">Partners</button>
            <button id="stupidpfpbutton" onclick="window.location.href='/settings.html';"><img id="header-img-btn" src="/images/settings.png" width="55px" height="55px" ></img></button>
            <button id="stupidpfpbutton" onclick="window.location.href='/profile/';"><img id="profile-pic" src="" width="55px" height="55px" ></img></button>
        </div>
    </header>
    <div id="roddyrichhesprisonprofile">
      <div id="main">
        <div id="user-info">
          <img id="big-profile-pic" src=""></img>
          <br>
          <input type="file" id="imageInput" name="image" accept="image/*" required>
          <button onclick="changepublicimage();">Save Image</button>
          <br>
          <input id="nameinput" required placeholder="enter in a new name!">
          <button onclick="changepublicname();">Save Name</button>
          <br>
          <h2 id="user-name"></h2>
          <br>

          <div id="bio-section" >
            <textarea id="bio-input" placeholder="describe yourself with a bio!" rows="4" cols="50"></textarea>
            <br>
              <button onclick="updateBio()">update bio</button>
          </div>

        </div>
      </div>
    </div>
    <div id="background"></div>
    <div id="particles-js"></div>
    <script src="/particles.js"></script>
    <script src="/app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script src="/purify.min.js"></script>
    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyDQcJNa_j_PC3-K5er4ms0WvVXQS_CEcuE",
        databaseURL: "https://algebras4-44f23-default-rtdb.firebaseio.com",
        authDomain: "algebras4-44f23.firebaseapp.com",
        projectId: "algebras4-44f23",
        storageBucket: "algebras4-44f23.appspot.com",
        messagingSenderId: "512062724744",
        appId: "1:512062724744:web:653e3c7a504fb7255fdd3d"
      };
  
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
  
      // Initialize Firebase Auth and Database
      const auth = firebase.auth();
      const database = firebase.database();
  
      // Function to handle Google Sign-In
      function googleSignIn() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider)
          .then((result) => {
            // User signed in successfully.
            const user = result.user;
            console.log('User:', user);
            storeUserInfo(user);
            displayUserProfile(user);
            document.getElementById('logout').style.display = 'inline';
            document.getElementById('bio-section').style.display = 'block';
          }).catch((error) => {
            // Handle Errors here.
            console.error('Error during sign-in:', error);
          });
      }
  
      function storeUserInfo(user) {
        const userRef = database.ref('users/' + user.uid);
        console.log('gyatt');
        userRef.set({
          displayName: user.displayName,
          photoURL: user.photoURL,
          bio: 'set this bio to whatever you want in your profile settings!',
        }).then(() => {
          console.log('User info stored successfully');
          window.location.reload()
        }).catch((error) => {
          console.error('Error storing user info:', error);
        });
      }
  
      firebase.database.enableLogging(true);
  
  
  
      // Function to handle sign-out
      function signOut() {
        auth.signOut().then(() => {
          // Sign-out successful.
          document.getElementById('big-profile-pic').src = '';
          console.log('User signed out.');
        }).catch((error) => {
          // An error happened.
          console.error('Error during sign-out:', error);
        });
      }
  
      // Function to display user profile
      function displayUserProfile(user) {
        if (user) {
          const profilePicUrl = user.photoURL;
          const userUid = user.uid;
          const usersharelink = window.location + "?useruid=" + userUid
          const userRef = database.ref('users/' + user.uid);
          userRef.once('value').then((snapshot) => {
          if (!snapshot.exists()) {
          then(() => {
            console.log('no bio!');
            document.getElementById('bio-input').value = "set this bio to whatever you want in your profile settings!";
          }).catch((error) => {
        console.error('error getting bio:', error);
        });
         } else {
         console.log('bio already exists');
         const userData = snapshot.val();
         document.getElementById('bio-input').value = userData.bio || "Describe yourself with a bio!";
          }
     }).catch((error) => {
         console.error('Error checking user profile:', error);
     });
          document.getElementById('big-profile-pic').src = profilePicUrl;
          document.getElementById('profile-pic').src = profilePicUrl;
          document.getElementById('logout').style.display = 'visible';
          document.getElementById('linkmaker').style.display = 'visible';
          document.getElementById('signin').style.display = 'none';
          document.getElementById('user-info').style.display = 'flex';
          document.getElementById('user-name').textContent = user.displayName;
          document.getElementById('uid').textContent = userUid;
          document.getElementById('usersharelink').value = usersharelink;
        }
      }


      function changepublicname() {
        const nameinputrizz = document.getElementById('nameinput').value;
        const user = auth.currentUser;
        const userRef = database.ref('users/' + user.uid);
        console.log('gyatt');
        userRef.update({
          displayName: nameinputrizz,
        }).then(() => {
          console.log('sigmaed EVERYWHERE!');
          window.location.reload()
        }).catch((error) => {
          console.error('Error storing user info:', error);
        });
      }
  
      function changepublicimage() {
        const user = auth.currentUser;
        const userRef = database.ref('users/' + user.uid);
        console.log('gyatt');
        let reader = new FileReader();
        let isReaderBusy = false;  // To prevent multiple reads simultaneously

        const fileInput = document.getElementById('imageInput').files[0];
            const output = document.getElementById('base64Output');

            if (!fileInput) {
                alert("give me an image first.");
                return;
            }

            // Check if the FileReader is already busy
            if (isReaderBusy) {
                alert("wait monkey!!1!11111");
                return;
            }

            isReaderBusy = true; // Mark reader as busy

            reader.onloadend = function () {
                const base64String = reader.result;
                console.log(base64String);
                userRef.update({
          photoURL: base64String
        }).then(() => {
          console.log('sigmaed EVERYWHERE!');
          alert('sigmaed EVERYWHERE!')
          window.location.reload()
        }).catch((error) => {
          console.error('Error storing user info:', error);
        });
                isReaderBusy = false; // Mark reader as available again
            };

            reader.onerror = function () {
                alert("an error occoured...");
                isReaderBusy = false; // Reset reader state on error
            };

            reader.readAsDataURL(fileInput); // Convert the image file to Base64
      }
  

      function updateBio() {
        const user = auth.currentUser;
        if (user) {
          const bioInput = document.getElementById('bio-input').value;
          const userRef = database.ref('users/' + user.uid);
          const sanitizedBio = DOMPurify.sanitize(bioInput, { ALLOWED_TAGS: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'style'] });
          userRef.update({
            bio: sanitizedBio
          }).then(() => {
            console.log('Bio updated successfully');
            window.location.href = '/profile/';
          }).catch((error) => {
            console.error('Error updating bio:', error);
            alert('Error updating bio:', error);
          });
        } else {
          console.error('No user is signed in');
          alert('No user is signed in');
        }
      }


      function copyToClipboard() {
              var inputField = document.getElementById("usersharelink");
          
              if (navigator.clipboard) {
                  navigator.clipboard.writeText(inputField.value).then(function() {
                  }).catch(function(err) {
                      console.error('Could not copy text: ', err);
                  });
              } else {
                  inputField.select();
                  inputField.setSelectionRange(0, 99999);
                  document.execCommand("copy");
              }
          }
          
  
      // Function to fetch user info from Firebase Realtime Database
      async function fetchUserInfo(uid) {
        try {
          const userRef = database.ref('users/' + uid);
          userRef.once('value').then((snapshot) => {
            if (snapshot.exists()) {
              const userData = snapshot.val();
              document.getElementById('big-profile-pic').src = userData.photoURL || '';
              document.getElementById('user-name').textContent = userData.displayName;
              document.getElementById('user-info').style.display = 'flex';
            } else {
              console.error('No such user!');
              document.getElementById('big-profile-pic').src = '/images/user-notallowed.png';
              document.getElementById('user-name').textContent = 'user doesnt exist!';
              document.getElementById('user-info').style.display = 'flex';
            }
          }).catch((error) => {
            console.error('Error fetching user info:', error);
            document.getElementById('big-profile-pic').src = '/images/user-notallowed.png';
            document.getElementById('user-name').textContent = 'you must be authenticated to use this feature!';
            document.getElementById('user-info').style.display = 'flex';
            document.getElementById('signin').style.display = 'visible';
          });
        } catch (error) {
          console.error('Error fetching user info:', error);
          document.getElementById('big-profile-pic').src = '/images/user-notallowed.png';
          document.getElementById('user-name').textContent = 'you must be authenticated to use this feature!';
            document.getElementById('user-info').style.display = 'flex';
            document.getElementById('signin').style.display = 'visible';
        }
      }
  
      // Function to get URL query parameter
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }
  
  
      auth.onAuthStateChanged((user) => {
        if (user) {
          // User is signed in.
          displayUserProfile(user);
        } else {
          // User is signed out.
          document.getElementById('big-profile-pic').src = '/images/user.png';
          document.getElementById('profile-pic').src = '/images/user.png';
          document.getElementById('user-name').textContent = 'login to have a name!';
          document.getElementById('logout').style.display = 'none';
          document.getElementById('signin').style.display = 'inline';
          document.getElementById('uid').textContent = 'uid not avaliable';
          document.getElementById('usersharelink').style.display = 'none';
          document.getElementById('account-info').style.display = 'none';
          document.getElementById('linkmaker').style.display = 'none';
        }
      });
      // Event listener to check for useruid in URL
      document.addEventListener('DOMContentLoaded', () => {
        const uid = getQueryParam('useruid');
        if (uid) {
          fetchUserInfo(uid);
          document.getElementById('logout').style.display = 'none';
          document.getElementById('signin').style.display = 'none';
          document.getElementById('uid').style.display = 'none';
          document.getElementById('totally-uid').style.display = 'none';
          document.getElementById('user-info').style.display = 'none';
          document.getElementById('usersharelink').style.display = 'none';
          document.getElementById('account-info').style.display = 'none';
          document.getElementById('linkmaker').style.display = 'none';
        }
      });
  
    </script>

</body>
</html>
