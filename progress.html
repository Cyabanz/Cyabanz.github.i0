<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress</title>
    <script type="module">
        import { initializeApp } from "firebase/app";
        import { getAnalytics } from "firebase/analytics";
        import { getDatabase, ref, set, onValue } from "firebase/database";
        import { getAuth, onAuthStateChanged } from "firebase/auth";

        const firebaseConfig = {
            apiKey: "AIzaSyDQcJNa_j_PC3-K5er4ms0WvVXQS_CEcuE",
            authDomain: "algebras4-44f23.firebaseapp.com",
            databaseURL: "https://algebras4-44f23-default-rtdb.firebaseio.com",
            projectId: "algebras4-44f23",
            storageBucket: "algebras4-44f23.appspot.com",
            messagingSenderId: "512062724744",
            appId: "1:512062724744:web:653e3c7a504fb7255fdd3d",
            measurementId: "G-4R378XMPSW"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);
        const auth = getAuth();

        function initializeUserData(userId) {
            const userRef = ref(database, 'users/' + userId);
            const initialData = {
                coins: 1000,
                lastRewardClaim: null,
                dailyProgress: {
                    day1: false,
                    day2: false,
                    day3: false,
                    day4: false,
                    day5: false,
                    day6: false,
                    day7: false
                },
                purchasedItems: {
                    item1: false,
                    item2: false
                }
            };

            set(userRef, initialData)
                .then(() => {
                    console.log('User data initialized successfully!');
                })
                .catch((error) => {
                    console.error('Error initializing user data: ', error);
                });
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                const userId = user.uid;
                const userRef = ref(database, 'users/' + userId);
                onValue(userRef, (snapshot) => {
                    if (!snapshot.exists()) {
                        initializeUserData(userId);
                    } else {
                        const userData = snapshot.val();
                        updateProgressBar(userData.dailyProgress);
                    }
                });
            } else {
                console.log('User is not signed in');
            }
        });

        function updateProgressBar(dailyProgress) {
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            let completedDays = 0;

            for (let day in dailyProgress) {
                if (dailyProgress[day]) {
                    completedDays++;
                }
            }

            const progressPercentage = (completedDays / 7) * 100;
            progressBar.style.width = progressPercentage + '%';
            progressContainer.textContent = `Completed: ${completedDays} out of 7 days`;
        }
    </script>
    <style>
        #progressContainer {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 20px 0;
        }

        #progressBar {
            height: 30px;
            width: 0;
            background-color: #76c7c0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Your Daily Reward Progress</h1>
    <div id="progressContainer">
        <div id="progressBar"></div>
    </div>
    <div id="dailyProgressText"></div>
</body>
</html>
